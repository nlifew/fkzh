{
  "data": [{
    "id": "6_1741148077.127",
    "type": "feed",
    "offset": 6,
    "verb": "TOPIC_ACKNOWLEDGED_ANSWER",
    "created_time": 1741148077,
    "updated_time": 1741148077,
    "target": {
      "id": "3562527236",
      "type": "answer",
      "url": "https://api.zhihu.com/answers/3562527236",
      "author": {
        "id": "f57b3d69796b02621ba7414e82176d72",
        "url": "https://api.zhihu.com/people/f57b3d69796b02621ba7414e82176d72",
        "user_type": "people",
        "url_token": "yu-xia-tian-33-20",
        "name": "若土",
        "headline": "我见诸君多傻β，料诸君见我应如是",
        "avatar_url": "https://pica.zhimg.com/50/v2-fe35e4c4806e70f263c46c8ad297f890_l.jpg?source=b6762063",
        "is_org": false,
        "gender": -1,
        "followers_count": 133,
        "is_following": false,
        "is_followed": false
      },
      "created_time": 1721023141,
      "updated_time": 1724922006,
      "voteup_count": 8207,
      "thanks_count": 1822,
      "comment_count": 202,
      "is_copyable": true,
      "question": {
        "id": "361826630",
        "type": "question",
        "url": "https://api.zhihu.com/questions/361826630",
        "author": {
          "id": "f0b8d3ac0c096a9b6c93db636bd4cc1d",
          "url": "https://api.zhihu.com/people/f0b8d3ac0c096a9b6c93db636bd4cc1d",
          "user_type": "people",
          "url_token": "fan-dou-hua-yuan-er-hao-jie-xiao-wu-za",
          "name": "拜拜",
          "headline": "嘤嘤嘤我是一只蚊子",
          "avatar_url": "https://pic1.zhimg.com/50/v2-6d41263a7ae71966c105f1f7664ed791_l.jpg?source=b6762063",
          "is_org": false,
          "gender": 1,
          "followers_count": 1111,
          "is_following": false,
          "is_followed": false
        },
        "title": "有哪些一看就莫名感到伤感的图片？",
        "created": 1576735456,
        "answer_count": 0,
        "follower_count": 0,
        "comment_count": 72,
        "bound_topic_ids": [2055, 10553, 31507],
        "is_following": false,
        "excerpt": "",
        "relationship": {
          "is_author": false
        },
        "detail": "",
        "question_type": "normal"
      },
      "thumbnail": "https://picx.zhimg.com/50/v2-4538b1d6798a4e7b10ed9f447c91f5d3_720w.jpg?source=b6762063",
      "excerpt": "有没有大佬知道这张图片的出处，拜托了。   -------------",
      "excerpt_new": "有没有大佬知道这张图片的出处，拜托了。   -------------",
      "preview_type": "default",
      "preview_text": "",
      "reshipment_settings": "allowed",
      "content": "\u003cp\u003e\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic3.zhimg.com/v2-8a885da661a9ca753a2b26ad592af604_1440w.gif\" data-rawwidth=\"600\" data-rawheight=\"338\" data-size=\"normal\" data-original-token=\"v2-8a885da661a9ca753a2b26ad592af604\" data-thumbnail=\"https://pic3.zhimg.com/v2-8a885da661a9ca753a2b26ad592af604_b.jpg\" data-default-watermark-src=\"https://pic3.zhimg.com/v2-8a885da661a9ca753a2b26ad592af604_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"600\" data-original=\"https://pic3.zhimg.com/v2-8a885da661a9ca753a2b26ad592af604_r.jpg\"/\u003e\u003c/figure\u003e\u003cp data-pid=\"sM3Ir8PQ\"\u003e有没有大佬知道这张图片的出处，拜托了。\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://picx.zhimg.com/v2-0ff41f9fb4f596efcf0b7c7dff9c0d9d_1440w.jpg\" data-rawwidth=\"1200\" data-rawheight=\"1328\" data-size=\"normal\" data-original-token=\"v2-0ff41f9fb4f596efcf0b7c7dff9c0d9d\" data-default-watermark-src=\"https://pica.zhimg.com/v2-6afcfc96a0f84feb497744a7d346bfc8_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1200\" data-original=\"https://picx.zhimg.com/v2-0ff41f9fb4f596efcf0b7c7dff9c0d9d_r.jpg\"/\u003e\u003c/figure\u003e\u003cp data-pid=\"HU_ZmX9F\"\u003e-------------\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic4.zhimg.com/v2-fd5a93d68b06010447ec4fa0a8911e77_1440w.jpg\" data-rawwidth=\"1200\" data-rawheight=\"1636\" data-size=\"normal\" data-original-token=\"v2-fd5a93d68b06010447ec4fa0a8911e77\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-e0a8249f223e904b1b0954f0f5a5a50b_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1200\" data-original=\"https://pic4.zhimg.com/v2-fd5a93d68b06010447ec4fa0a8911e77_r.jpg\"/\u003e\u003c/figure\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic4.zhimg.com/v2-f07ffefe0ae83e81f77da19cde3a8933_1440w.jpg\" data-rawwidth=\"600\" data-rawheight=\"894\" data-size=\"normal\" data-original-token=\"v2-f07ffefe0ae83e81f77da19cde3a8933\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-5221c56168a56f8c3218b980ef72b297_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"600\" data-original=\"https://pic4.zhimg.com/v2-f07ffefe0ae83e81f77da19cde3a8933_r.jpg\"/\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e",
      "relationship": {
        "is_thanked": false,
        "is_nothelp": false,
        "voting": 0
      },
      "is_labeled": false,
      "visited_count": 1080547,
      "thumbnails": ["https://picx.zhimg.com/50/v2-4538b1d6798a4e7b10ed9f447c91f5d3_720w.jpg?source=b6762063", "https://pic1.zhimg.com/50/v2-07b56d66b2e150fef5746f2fbbb400ac_720w.jpg?source=b6762063"],
      "favorite_count": 3622,
      "answer_type": "normal"
    },
    "brief": "{\"source\": \"TS\", \"type\": \"answer\", \"id\": 3562527236}",
    "attached_info": "CssICIiI3+OMxaelrgEQBBoJNjc3ODAzMzA5IKX10rQGKI9AMMoBQAZKMQomVFNfU09VUkNFX1RFWFRfTVVMVElWSUVXX0dDRl9VU0VSQ0ZfVjESATAYACAAOgBaCDQyNjg0NzEzYiA0MDYyZmNlNDE5NWZmZGNkMWZmNjIwN2UwYTA3MDhiYXIKMzU2MjUyNzIzNooBCTM2MTgyNjYzMKoBCXJlY29tbWVuZMIBIGY1N2IzZDY5Nzk2YjAyNjIxYmE3NDE0ZTgyMTc2ZDcy8gEKCAwSBk5vcm1hbPIBKAgKEiQwNzIzNDJkNy1kZjk0LTRhNmEtYjI3OS1iMGVmM2MxNzkxNjTyAQUICxIBMoICAIgC8/2MpNYykgIgZjU3YjNkNjk3OTZiMDI2MjFiYTc0MTRlODIxNzZkNzKaAgDKAhRGaXJzdEJydXNoV2VpZ2h0UnVsZcoCFkFjdGlvblNob3JJbnRlcmVzdFJ1bGXKAhtJbnRlcmFjdGlvblNob3JJbnRlcmVzdFJ1bGXKAhZSZXZpc2l0VmFsdWVXZWlnaHRSdWxlygIYUGVyaW9kSW50ZXJlc3RXZWlnaHRSdWxlygIVTmVnRmVlZEJhY2tXZWlnaHRSdWxlygIVVXNlckxjbkV4aXRXZWlnaHRSdWxlygIUQ29udGVudEFnZVdlaWdodFJ1bGXKAiNRdWFsaXR5SW50ZXJhY3Rpb25Db250ZW50V2VpZ2h0UnVsZcoCFVVzZXJVbkludGVyZXN0QWdnUnVsZdoCJlRTX1NPVVJDRV9URVhUX01VTFRJVklFV19HQ0ZfVVNFUkNGX1Yx6AIC+gILTk9STUFMX0ZMT1eKAyA5ZmI1NGVhZjhlZTA0OWViYjg3NWU1ZTE5N2QyYjE2NZoDDQoCdjIQABoFb3RoZXKoA+P5QdgDAOoDGmZlZWQtdGV4dC1tdWx0aS11Y2YtcmVjYWxs+gPbARIMVU5LTk9XTl9NT0RFIAAqDU5PX0lNQUdFX01PREU6LQgDENgEGNICIiN2Mi04YTg4NWRhNjYxYTljYTc1M2EyYjI2YWQ1OTJhZjYwNDotCAIQsAkYsAoiI3YyLTBmZjQxZjlmYjRmNTk2ZWZjZjBiN2M3ZGZmOWMwZDlkOi0IAhCwCRjkDCIjdjItZmQ1YTkzZDY4YjA2MDEwNDQ3ZWM0ZmEwYTg5MTFlNzc6LQgCENgEGP4GIiN2Mi1mMDdmZmVmZTBhZTgzZTgxZjc3ZGExOWNkZTNhODkzM4AEAIgEAJIEBk5vcm1hbJoEATKgBACoBACwBAC6BAZtYW51YWzCBAMxNjDIBADSBA/mjqjojZDlt7Lmm7TmlrDYBADwBAD5BAAAAGAX/74/gQUAAAAAAAAAAIkFoR0RsfZxtD+SBQCaBQNkZnSiBQNkZnSyBQExuQUAAAAAAAAAANAFAOAFAOgFAPAFApAGAKAGBqgGAZICJQoJNjc3ODAzMzA5EgozNTYyNTI3MjM2GAQiCklNQUdFX1RFWFQ=",
    "action_card": false
  }, {
    "id": "7_1741148077.480",
    "type": "feed",
    "offset": 7,
    "verb": "TOPIC_ACKNOWLEDGED_ANSWER",
    "created_time": 1741148077,
    "updated_time": 1741148077,
    "target": {
      "id": "113985084378",
      "type": "answer",
      "url": "https://api.zhihu.com/answers/113985084378",
      "author": {
        "id": "6ef2e77274cb0719253a577665cf690e",
        "url": "https://api.zhihu.com/people/6ef2e77274cb0719253a577665cf690e",
        "user_type": "people",
        "url_token": "Ivony",
        "name": "Ivony",
        "headline": "大隐隐知乎",
        "avatar_url": "https://pic1.zhimg.com/50/23a5bca736788ab73e3bd58e56761cda_l.jpg?source=b6762063",
        "is_org": false,
        "gender": 1,
        "badge": [{
          "type": "best_answerer",
          "description": "编程话题下的优秀答主",
          "topic_names": ["编程"],
          "topic_ids": [1354]
        }],
        "followers_count": 261688,
        "is_following": false,
        "is_followed": false
      },
      "created_time": 1740854206,
      "updated_time": 1740861580,
      "voteup_count": 158,
      "thanks_count": 4,
      "comment_count": 19,
      "is_copyable": true,
      "question": {
        "id": "13684481248",
        "type": "question",
        "url": "https://api.zhihu.com/questions/13684481248",
        "author": {
          "id": "89911bb8522e1d21d35fb47383661086",
          "url": "https://api.zhihu.com/people/89911bb8522e1d21d35fb47383661086",
          "user_type": "people",
          "url_token": "qxvllf",
          "name": "SOCL2",
          "headline": "化学爱好者，正在学习计算机\n热闹不会停止",
          "avatar_url": "https://picx.zhimg.com/50/v2-489cb349d0da189fb01cfd615c69e8ac_l.jpg?source=b6762063",
          "is_org": false,
          "gender": 1,
          "followers_count": 6,
          "is_following": false,
          "is_followed": false
        },
        "title": "为什么C语言从不被淘汰？那些Rust/Go吹嘘的安全特性，C语言真的做不到吗?",
        "created": 1740751591,
        "answer_count": 0,
        "follower_count": 0,
        "comment_count": 8,
        "is_following": false,
        "excerpt": "",
        "relationship": {
          "is_author": false
        },
        "detail": "",
        "question_type": "normal"
      },
      "excerpt": "其实我的建议是少看点儿这种比较的玩意儿…… C语言的本质是将堆栈和函数调用封装起来的汇编语言。 他在这个生态位就是要手动管理堆内存，不手动管理栈内存，就这么简单。 堆内存管理方式千千万，但只要不是手动管理那就不是C语言。不能手动管理就 无法做到直接内存寻址，做到直接内存寻址就无法自动管理，这两者显然互斥。 所以这特么就是废话，不需要手动管理堆内存的语言多了去了，但是不存在一个语言可以同时实现你可以向FFF…",
      "excerpt_new": "其实我的建议是少看点儿这种比较的玩意儿…… C语言的本质是将堆栈和函数调用封装起来的汇编语言。 他在这个生态位就是要手动管理堆内存，不手动管理栈内存，就这么简单。 堆内存管理方式千千万，但只要不是手动管理那就不是C语言。不能手动管理就 无法做到直接内存寻址，做到直接内存寻址就无法自动管理，这两者显然互斥。 所以这特么就是废话，不需要手动管理堆内存的语言多了去了，但是不存在一个语言可以同时实现你可以向FFF…",
      "preview_type": "default",
      "preview_text": "",
      "reshipment_settings": "allowed",
      "content": "\u003cp data-pid=\"y67Q5YAs\"\u003e其实我的建议是少看点儿这种比较的玩意儿……\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"fauVEWEE\"\u003eC语言的本质是将堆栈和函数调用封装起来的汇编语言。\u003cb\u003e他在这个生态位就是要手动管理堆内存，不手动管理栈内存\u003c/b\u003e，就这么简单。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"QOj3KThj\"\u003e堆内存管理方式千千万，但只要不是手动管理那就不是C语言。不能手动管理就\u003cb\u003e无法做到直接内存寻址\u003c/b\u003e，做到直接内存寻址就无法自动管理，这两者\u003cb\u003e显然互斥\u003c/b\u003e。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"3Q-2iwUQ\"\u003e所以这特么就是废话，不需要手动管理堆内存的语言多了去了，但是不存在一个语言可以同时实现你可以向FFFF0008位置写入一个字节，同时又可以自动帮你管理堆内存。\u003c/p\u003e\u003cp data-pid=\"jcbAVQ9t\"\u003e因为前者意味着你可以把他的自动堆内存管理给穿个千疮百孔……\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"Cb69zywi\"\u003e前者就是C语言/汇编语言。后者就是其他语言……\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003chr/\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"ALbXVSrL\"\u003e稍微讲讲为什么C++或者unsafe啥的不能解决这个问题吧。\u003c/p\u003e\u003cp data-pid=\"YHhHntE9\"\u003e这里面有一个很容易迷惑人的问题在于自行管理堆内存，很多时候不是真的要管理内存。很多时候就是要直接寻址，内存本质上不是一个什么存储空间，他的本质就是一个地址，CPU可以从这个地址获取到数据。\u003c/p\u003e\u003cp data-pid=\"ZFxCGstP\"\u003e所以很多时候，一个内存地址他不一定真的是内存，比如说磁盘文件映射或者DMM。你只要用了可以自动分配内存的东西，你就无法保证这些东西会不会给你分配到那些根本用不了的内存地址。除非你自己实现内存分配的逻辑，而如果你自己实现内存分配的逻辑，那你就会发现这个逻辑就不能是语法的一部分（比如说new）。\u003c/p\u003e\u003cp data-pid=\"WUHWLPvk\"\u003e所以这里就是个死循环，如果你要直接寻址，你就无法从自动内存管理中获得益处，甚至于在特殊场景下你不得不放弃自动内存管理。\u003c/p\u003e\u003cp data-pid=\"I8jwCCvR\"\u003e所以同样的道理，如果你连栈都不要，或者说你要自行管理堆栈。那C语言也不能用，你比如说C语言内部也不能直接对SP赋值。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"k9_PWEeR\"\u003e那么回到问题，我现在就是要从特定的地址读写数据，那除了C也确实就没有什么别的办法。\u003c/p\u003e",
      "relationship": {
        "is_thanked": false,
        "is_nothelp": false,
        "voting": 0
      },
      "is_labeled": false,
      "visited_count": 15018,
      "favorite_count": 71,
      "answer_type": "normal"
    },
    "brief": "{\"source\": \"TS\", \"type\": \"answer\", \"id\": 113985084378}",
    "attached_info": "CpsHCIiI3+OMxaelrgEQBBoJNzE1OTExMjAzIL6njb4GKJ4BMBNAB0ooCh1UU19TT1VSQ0VfTkVBUkxJTkVfQ09OVEVOVF9WMhIBMBgAIAA6AEpBCixUU19TT1VSQ0VfVFdPVE9XRVJfU0hPUlRJTlRFUkVTVF9SRUNBTExfVEVYVBIBMBgAIAA6CnsicmF3IjoiIn1aCTExMzcxMjMzN2IgNDA2MmZjZTQxOTVmZmRjZDFmZjYyMDdlMGEwNzA4YmFyDDExMzk4NTA4NDM3OIoBCzEzNjg0NDgxMjQ4qgEJcmVjb21tZW5kwgEgNmVmMmU3NzI3NGNiMDcxOTI1M2E1Nzc2NjVjZjY5MGXyAQoIDBIGTm9ybWFs8gEoCAoSJGEyNWI3ODIzLTc2NzYtNGZkZi1iOTQyLTliZmNmMjc0NTkyOfIBBQgLEgEyggIAiAL0/Yyk1jKSAiA2ZWYyZTc3Mjc0Y2IwNzE5MjUzYTU3NzY2NWNmNjkwZZoCAMoCFEZpcnN0QnJ1c2hXZWlnaHRSdWxlygIWU2hvckludGVyZXN0V2VpZ2h0UnVsZcoCFkFjdGlvblNob3JJbnRlcmVzdFJ1bGXKAhtJbnRlcmFjdGlvblNob3JJbnRlcmVzdFJ1bGXKAhhQZXJpb2RJbnRlcmVzdFdlaWdodFJ1bGXKAhVOZWdGZWVkQmFja1dlaWdodFJ1bGXKAhZOZWdSZWNhbGxUYWdXZWlnaHRSdWxlygIXVXNlckV4Y2x1c2l2ZVdlaWdodFJ1bGXKAhVVc2VyTGNuRXhpdFdlaWdodFJ1bGXKAhVVc2VyVW5JbnRlcmVzdEFnZ1J1bGXaAh1UU19TT1VSQ0VfTkVBUkxJTkVfQ09OVEVOVF9WMugCAvoCC05PUk1BTF9GTE9XigMgOWZiNTRlYWY4ZWUwNDllYmI4NzVlNWUxOTdkMmIxNjWaAw0KAnYyEAAaBW90aGVyqAOqddgDAPoDHxIMVU5LTk9XTl9NT0RFIAAqDU5PX0lNQUdFX01PREWABACIBACSBAZOb3JtYWyaBAEyoAQAqAQAsAQAugQGbWFudWFswgQDMTcwyAQA0gQP5o6o6I2Q5bey5pu05paw2AQA8AQA+QQAAACAV/G5P4EFAAAAAAAAAACJBaEdEbH2cbQ/kgUAmgUDZGZ0ogUDZGZ0sgUBMbkFAAAAAAAAAADQBQDgBQDoBQDwBQKQBgCgBgeoBgCSAicKCTcxNTkxMTIwMxIMMTEzOTg1MDg0Mzc4GAQiCklNQUdFX1RFWFQ=",
    "action_card": false
  }, {
    "id": "8_1741148077.478",
    "type": "feed",
    "offset": 8,
    "verb": "TOPIC_ACKNOWLEDGED_ARTICLE",
    "created_time": 1741148077,
    "updated_time": 1741148077,
    "target": {
      "id": "716915076",
      "type": "article",
      "url": "https://api.zhihu.com/articles/716915076",
      "author": {
        "id": "382075fa95d7a54e58ce3f2a8546e5e1",
        "url": "https://api.zhihu.com/people/382075fa95d7a54e58ce3f2a8546e5e1",
        "user_type": "people",
        "url_token": "foolzero",
        "name": "foolzero",
        "headline": "",
        "avatar_url": "https://picx.zhimg.com/50/v2-abed1a8c04700ba7d72b45195223e0ff_l.jpg?source=b6762063",
        "is_org": false,
        "gender": -1,
        "followers_count": 49,
        "is_following": false,
        "is_followed": false
      },
      "title": "记录一次和linux SD卡驱动搏斗的经历",
      "image_url": "https://picx.zhimg.com/v2-72c0a1941dc03e3b44088e877f162e8a.jpg?source=7e7ef6e2\u0026needBackground=1",
      "comment_permission": "all",
      "created": 1724832653,
      "updated": 1725047256,
      "voteup_count": 311,
      "voting": 0,
      "comment_count": 20,
      "linkbox": {
        "category": "",
        "pic": "",
        "title": "",
        "url": ""
      },
      "excerpt": "2022年的时候手机坏了，随便买了个手机用。型号是一加Nord N200。内置存储只有64g不够用，所以插了张sd卡。开启adoptable storage之后可以把应用装到sd卡。但是发现sd卡里的应用速度巨慢，就给sd卡测了个速。软件：CPDT benchmark     手机上只有20M的顺序读取。但是同一张卡在电脑上用读卡器可以跑到90M的顺序读取。一开始以为是手机的读卡器比较烂，遂躺平。最近又想起这回事，感觉2022年的设备就算再省成本只给20M也有点离谱了。…",
      "excerpt_new": "2022年的时候手机坏了，随便买了个手机用。型号是一加Nord N200。内置存储只有64g不够用，所以插了张sd卡。开启adoptable storage之后可以把应用装到sd卡。但是发现sd卡里的应用速度巨慢，就给sd卡测了个速。软件：CPDT benchmark     手机上只有20M的顺序读取。但是同一张卡在电脑上用读卡器可以跑到90M的顺序读取。一开始以为是手机的读卡器比较烂，遂躺平。最近又想起这回事，感觉2022年的设备就算再省成本只给20M也有点离谱了。…",
      "preview_type": "default",
      "preview_text": "",
      "content": "\u003cp data-pid=\"Bge_H1j1\"\u003e2022年的时候手机坏了，随便买了个手机用。型号是一加Nord N200。内置存储只有64g不够用，所以插了张sd卡。开启adoptable storage之后可以把应用装到sd卡。但是发现sd卡里的应用速度巨慢，就给sd卡测了个速。软件：CPDT benchmark\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic2.zhimg.com/v2-0d90c1b14ac75831ff22c56c56b6101b_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"2400\" data-original-token=\"v2-72c0a1941dc03e3b44088e877f162e8a\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-0d90c1b14ac75831ff22c56c56b6101b_r.jpg\"/\u003e\u003cfigcaption\u003eCPDT 手机\u003c/figcaption\u003e\u003c/figure\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://picx.zhimg.com/v2-ac528502088e6e18948f73faa0592e6d_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"1700\" data-rawheight=\"1200\" data-original-token=\"v2-e4eb941ab114aad95edc09c6bf60cd8b\" class=\"origin_image zh-lightbox-thumb\" width=\"1700\" data-original=\"https://picx.zhimg.com/v2-ac528502088e6e18948f73faa0592e6d_r.jpg\"/\u003e\u003cfigcaption\u003eCPDT USB3.0读卡器\u003c/figcaption\u003e\u003c/figure\u003e\u003cp data-pid=\"vXTPPwRL\"\u003e手机上只有20M的顺序读取。但是同一张卡在电脑上用读卡器可以跑到90M的顺序读取。一开始以为是手机的读卡器比较烂，遂躺平。最近又想起这回事，感觉2022年的设备就算再省成本只给20M也有点离谱了。于是开始研究sd卡标准和linux内核驱动。\u003c/p\u003e\u003ch2\u003eSD卡总线速度\u003c/h2\u003e\u003cp data-pid=\"9vD19ziB\"\u003eSD卡的速度等级比较混乱，speed class，uhs speed class，video speed class规定了顺序写入的最小速度，application performance class 规定了随机读写的最小速度。但对于Linux驱动来说，我们需要关心的是总线速度。这里借用维基百科的表格\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pica.zhimg.com/v2-7f587ed7fca331665b84a0c75059072a_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"981\" data-rawheight=\"587\" data-original-token=\"v2-e542f498870cafd9342686e8fd125907\" class=\"origin_image zh-lightbox-thumb\" width=\"981\" data-original=\"https://pica.zhimg.com/v2-7f587ed7fca331665b84a0c75059072a_r.jpg\"/\u003e\u003cfigcaption\u003eSD总线速度\u003c/figcaption\u003e\u003c/figure\u003e\u003cp data-pid=\"av5yn_i8\"\u003e现在市面上大部分卡是UHS-1标准，运行在SDR104模式，理论最大可以达到104MB/s的速度。我在电脑上测出来的90MB/s比较接近这个值。老一些的卡只支持high speed，最大25MB/s。UHS也支持几种较慢的模式 （SDR50，SDR25，SDR12）。我在手机上测出来20MB/s多一点，怀疑是跑在了high speed或SDR25上。\u003c/p\u003e\u003cp data-pid=\"xEL_3qUm\"\u003e两种模式的总线宽度都为4bit，每周期可以传输0.5字节数据，时钟频率正好是传输速率的两倍。UHS-1和high speed分别需要208MHz和50MHz的时钟。UHS-1的信号电压为1.8V，high speed为3.3V。\u003c/p\u003e\u003ch2\u003e突破口：dmesg\u003c/h2\u003e\u003cp data-pid=\"pEzPV4E9\"\u003e使用dmesg可以查看内核日志。从dmesg | grep mmc 可以看到\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-text\"\u003e[    2.368925] mmc1: SDHCI controller on 4784000.sdhci [4784000.sdhci] using ADMA 64-bit\n[    2.487514] mmc1: new ultra high speed SDR104 SDXC card at address 59b4\n[    2.487989] mmcblk1: mmc1:59b4 SPCC  236 GiB \n[    2.491455] mmcblk1: p1 p2\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-text\"\u003emmc1: Skipping voltage switch\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-text\"\u003emmc1: mmc_clk_update_freq: High freq was overridden to 50000000\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"yVtWu3qG\"\u003e从最后一条可以看出，sd卡的最高频率被限制在了50MHz，看来之前的猜想基本正确。\u003c/p\u003e\u003ch2\u003e寻找输出来源\u003c/h2\u003e\u003cp data-pid=\"9Pp3QdHN\"\u003e有了这三条输出就可以到内核源码里定位。我刷了lineageOS，可以到lineageOS的网站上下载内核源码：\u003c/p\u003e\u003cp data-pid=\"GQaIG6FW\"\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//github.com/LineageOS/android_kernel_oneplus_sm4350/tree/lineage-21\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003eLineageOS/android_kernel_oneplus_sm4350 (github.com)\u003c/a\u003e\u003c/p\u003e\u003cp data-pid=\"d47v7770\"\u003e第一条在drivers/mmc/core/bus.c，mmc_add_card()函数：\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"n\"\u003epr_info\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;%s: new %s%s%s%s%s%s card at address %04x\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003emmc_hostname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003emmc_card_uhs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ultra high speed \u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_card_hs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;high speed \u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003emmc_card_hs400\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;HS400 \u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_card_hs200\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;HS200 \u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003emmc_card_hs400es\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Enhanced strobe \u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003emmc_card_ddr52\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;DDR \u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003euhs_bus_speed_mode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erca\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"llKkd6sH\"\u003e能打印出\u0026#34;ultra high speed\u0026#34;和\u0026#34;SDR104\u0026#34;说明检测到sd卡是支持uhs的。\u003c/p\u003e\u003cp data-pid=\"mDIPwypQ\"\u003e第二条在 drivers/mmc/core/sd.c，mmc_sd_get_cid()函数：\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_sd_get_cid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eu32\u003c/span\u003e \u003cspan class=\"n\"\u003eocr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eu32\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eu32\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003erocr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eu32\u003c/span\u003e \u003cspan class=\"n\"\u003emax_current\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eretries\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eu32\u003c/span\u003e \u003cspan class=\"n\"\u003epocr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eocr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nl\"\u003etry_again\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eretries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003eocr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;=\u003c/span\u003e \u003cspan class=\"o\"\u003e~\u003c/span\u003e\u003cspan class=\"n\"\u003eSD_OCR_S18R\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003epr_warn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;%s: Skipping voltage switch\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_hostname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_host_is_spi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eocr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eSD_OCR_S18R\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\t    \u003cspan class=\"n\"\u003erocr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003erocr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eSD_ROCR_S18A\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_set_uhs_voltage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epocr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eEAGAIN\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003eretries\u003c/span\u003e\u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003etry_again\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003eretries\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003etry_again\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_send_cid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecid\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"VUSsxlmz\"\u003e这个函数会通过mmc_set_uhs_voltage()（在drivers/mmc/core/core.c）把sd卡的电压设定到uhs的1.8V，最多重试10次。Skipping voltage switch说明达到了最大重试次数，放弃使用uhs模式。\u003c/p\u003e\u003cp data-pid=\"Un5KKYZq\"\u003e第三条在 drivers/mmc/core/core.c，mmc_clk_update_freq()函数：\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_clk_update_freq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003efreq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_load\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eunlikely\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efreq\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eclk_scaling_highest\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003efreq\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eclk_scaling_highest\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003epr_warn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;%s: %s: High freq was overridden to %lu\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003emmc_hostname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003e__func__\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eclk_scaling_highest\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"Iya1kzpK\"\u003eif条件成立，说明系统认为的sd卡的最高频率（host-\u0026gt;card-\u0026gt;clk_scaling_highest）达不到函数指定的频率（freq），需要进一步寻找谁决定了这个最高频率。\u003c/p\u003e\u003ch2\u003e为什么 mmc_sd_get_cid() 会失败\u003c/h2\u003e\u003cp data-pid=\"iHpyN-SE\"\u003emmc_set_uhs_voltage()的多次失败导致了mmc_sd_get_cid超过最大重试次数。mmc_set_uhs_voltage() 中有三处err = -EAGAIN，我在三处各加了一个pr_warn来查看到底是哪一步出错。编译运行修改过的内核，发现错误都在最后一步：\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * Failure to switch is indicated by the card holding\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * dat[0:3] low\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eops\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecard_busy\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eops\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecard_busy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eEAGAIN\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n\t\t\u003cspan class=\"n\"\u003epr_warn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;die 3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//加一条打印\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"LPP9J8m5\"\u003e这里检测电压切换是否成功，如果4条数据线全为低电平，说明切换失败。有趣的是，加了这条pr_warn之后，SD卡的速度竟然正常了！dmesg里可以看到pr_warn打印的内容，但不会超过10次，没有超过mmc_sd_get_cid()的最大重试次数。也就是说切换电压成功，SD卡运行在了UHS SDR104模式。猜测是打印起到了延时的作用，让驱动不要重试得太快。删掉pr_warn，在每次重试之前加一个10ms的延时，正常运行。\u003c/p\u003e\u003ch2\u003e好了，但没有完全好\u003c/h2\u003e\u003cp data-pid=\"pbF8tpjx\"\u003e以为修好了，开心去睡觉，结果起来发现又掉回high speed模式了。麻。继续扒代码。虽然加延时能让UHS模式多撑一段时间，mmc_sd_get_cid()还是会超过最大重试次数，并且mmc_sd_get_cid()失败一次之后就回不到UHS模式了。\u003c/p\u003e\u003cp data-pid=\"0OtVis8b\"\u003e 注意到之前加的pr_warn在不同的时间多次出现，显然不属于同一次重试，说明mmc_sd_get_cid()经常被调用。顺藤摸瓜，发现整个调用流程有两条线：\u003c/p\u003e\u003col\u003e\u003cli data-pid=\"ifZ1NMfH\"\u003emmc_attach_sd() \u0026gt;\u0026gt; mmc_sd_init_card() \u0026gt;\u0026gt; mmc_sd_get_cid()\u003c/li\u003e\u003c/ol\u003e\u003cp data-pid=\"PHuu3-QL\"\u003e2. mmc_sd_runtime_resume() \u0026gt;\u0026gt; _mmc_sd_resume() \u0026gt;\u0026gt; mmc_sd_init_card() \u0026gt;\u0026gt; mmc_sd_get_cid() \u003c/p\u003e\u003cp data-pid=\"6cZHOl6Q\"\u003e都定义在drivers/mmc/core/sd.c\u003c/p\u003e\u003cp data-pid=\"zj4ldTqq\"\u003e第一条线是SD卡的初始化，没有发现问题。\u003c/p\u003e\u003cp data-pid=\"vwH0Erlh\"\u003e第二条线是电源管理的suspend/resume机制。驱动会在SD卡空闲的时候暂时切断它的电源（suspend）来省电，在需要数据传输的时候再重新上电（resume）。每一次重新上电都相当于一次新的初始化，需要重新配置电压。如果这个过程很频繁，电压配置难免会有几次失败。现在的问题比较清晰了：为什么一旦电压配置失败一次，即使后续的resume配置电压成功，也无法跑到SDR104的速度。\u003c/p\u003e\u003ch2\u003e驱动如何决定SD卡总线的最大频率\u003c/h2\u003e\u003cp data-pid=\"hqKUB7ej\"\u003e这次从一开始看到的第三条dmesg和mmc_clk_update_freq()函数入手：\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-text\"\u003emmc1: mmc_clk_update_freq: High freq was overridden to 50000000\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_clk_update_freq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003efreq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eenum\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_load\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eunlikely\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efreq\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eclk_scaling_highest\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003efreq\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eclk_scaling_highest\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003epr_warn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;%s: %s: High freq was overridden to %lu\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003emmc_hostname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003e__func__\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eclk_scaling_highest\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"qRHUBU19\"\u003ehost-\u0026gt;card-\u0026gt;clk_scaling_highest只有50M。\u003c/p\u003e\u003cp data-pid=\"o9N4HD5R\"\u003e找clk_scaling_highest：\u003c/p\u003e\u003cp data-pid=\"sZvDEqaJ\"\u003emmc_sd_init_card() \u0026gt;\u0026gt; mmc_sd_get_max_clock() \u0026gt;\u0026gt; 返回 card-\u0026gt;sw_caps.uhs_max_dtr\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_sd_get_max_clock\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_card\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#if defined(CONFIG_SDC_QTI)\n\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_card_uhs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euhs_max_dtr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euhs_max_dtr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//返回这个\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_card_hs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehs_max_dtr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehs_max_dtr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecsd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecsd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emax_dtr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"OIFrXrE9\"\u003e找sw_caps.uhs_max_dtr：\u003c/p\u003e\u003cp data-pid=\"4AisKdlt\"\u003emmc_sd_init_card() \u0026gt;\u0026gt; mmc_sd_init_uhs_card() \u0026gt;\u0026gt; sd_set_bus_speed_mode()根据 card-\u0026gt;sd_bus_speed 设定 card-\u0026gt;sw_caps.uhs_max_dtr\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003esd_set_bus_speed_mode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_card\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eu8\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003etiming\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esd_bus_speed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nl\"\u003eUHS_SDR104_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e//应该走这里\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\t\u003cspan class=\"n\"\u003etiming\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_TIMING_UHS_SDR104\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euhs_max_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_SDR104_MAX_DTR\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nl\"\u003eUHS_DDR50_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003etiming\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_TIMING_UHS_DDR50\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euhs_max_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_DDR50_MAX_DTR\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nl\"\u003eUHS_SDR50_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003etiming\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_TIMING_UHS_SDR50\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euhs_max_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_SDR50_MAX_DTR\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nl\"\u003eUHS_SDR25_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e//但是走了这里\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\t\u003cspan class=\"n\"\u003etiming\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_TIMING_UHS_SDR25\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euhs_max_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_SDR25_MAX_DTR\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nl\"\u003eUHS_SDR12_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003etiming\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_TIMING_UHS_SDR12\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euhs_max_dtr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_SDR12_MAX_DTR\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"ikB-TqVf\"\u003e找card-\u0026gt;sd_bus_speed：\u003c/p\u003e\u003cp data-pid=\"aYbaNYbu\"\u003esd_update_bus_speed_mode()根据 card-\u0026gt;host-\u0026gt;caps 和 card-\u0026gt;sw_caps.sd3_bus_mode设定 card-\u0026gt;sd_bus_speed\u003c/p\u003e\u003cp data-pid=\"0HNBgOxt\"\u003ecard-\u0026gt;host-\u0026gt;caps print出来没有问题。问题出在card-\u0026gt;sw_caps.sd3_bus_mode\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003esd_update_bus_speed_mode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_card\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * If the host doesn\u0026#39;t support any of the UHS-I modes, fallback on\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * default speed.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_host_uhs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esd_bus_speed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecaps\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR104\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\t    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esd3_bus_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eSD_MODE_UHS_SDR104\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e//应该走这里\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esd_bus_speed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_SDR104_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecaps\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_CAP_UHS_DDR50\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\t\t   \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esd3_bus_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eSD_MODE_UHS_DDR50\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esd_bus_speed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_DDR50_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecaps\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR104\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\n\t\t    \u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR50\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esd3_bus_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\n\t\t    \u003cspan class=\"n\"\u003eSD_MODE_UHS_SDR50\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esd_bus_speed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_SDR50_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecaps\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR104\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\n\t\t    \u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR50\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR25\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\t\t   \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esd3_bus_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eSD_MODE_UHS_SDR25\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e//但是走了这里\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esd_bus_speed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_SDR25_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecaps\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR104\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\n\t\t    \u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR50\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR25\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\n\t\t    \u003cspan class=\"n\"\u003eMMC_CAP_UHS_SDR12\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esd3_bus_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\n\t\t    \u003cspan class=\"n\"\u003eSD_MODE_UHS_SDR12\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esd_bus_speed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUHS_SDR12_BUS_SPEED\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"UkQuAQdP\"\u003e找card-\u0026gt;sw_caps.sd3_bus_mode：\u003c/p\u003e\u003cp data-pid=\"FgKZYrmR\"\u003emmc_read_switch()向SD卡发送CMD6 mode0查询信息，并将返回值的第13个字节赋值给card-\u0026gt;sw_caps.sd3_bus_mode\u003c/p\u003e\u003cp data-pid=\"OnQed3hO\"\u003e根据SD Physical Layer Simplified Specification Version 3.01，CMD6 mode0的返回值包含6个function group，其中第13个字节是function group 1的低8位。这个字节代表SD卡支持哪些速度模式。如果当前电压为3.3V，只有bit0和bit1为1，代表只支持default speed和high speed。如果为1.8V，bit0-bit4都为1，代表支持UHS模式。原文：\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic2.zhimg.com/v2-6b91987dbc5a193fcf8ad54a9eaf351d_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"669\" data-rawheight=\"77\" data-original-token=\"v2-6b91987dbc5a193fcf8ad54a9eaf351d\" class=\"origin_image zh-lightbox-thumb\" width=\"669\" data-original=\"https://pic2.zhimg.com/v2-6b91987dbc5a193fcf8ad54a9eaf351d_r.jpg\"/\u003e\u003cfigcaption\u003eCMD6 Mode0 返回值 Function Group 1\u003c/figcaption\u003e\u003c/figure\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_read_switch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_card\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * Find out the card\u0026#39;s support bits with a mode 0 operation.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * The argument does not matter, as the support bits do not\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * change with the arguments.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_sd_switch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e// CMD6\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esd3_bus_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"FId-ZlvH\"\u003e总结一下，决定最大频率clk_scaling_highest的顺序是 mmc_read_switch(), sd_update_bus_speed_mode(), mmc_sd_get_max_clock()。这几个函数都从mmc_sd_init_card()出发。\u003c/p\u003e\u003cp data-pid=\"6HTbTdky\"\u003e到这里可以确定clk_scaling_highest是根据SD卡返回的信息决定的。最终由当前的工作电压决定。\u003c/p\u003e\u003cp data-pid=\"a62G61cq\"\u003e一切看起来都很合理，但还是没有解答我们的问题：为什么一次电压设定失败之后，clk_scaling_highest掉到50M，即使后续电压设置成功，clk_scaling_highest也回不去呢？\u003c/p\u003e\u003ch2\u003emmc_sd_init_card()调用 mmc_read_switch()的逻辑\u003c/h2\u003e\u003cp data-pid=\"Wum-i0AU\"\u003emmc_sd_init_card()调用mmc_read_switch()有两条线：\u003c/p\u003e\u003col\u003e\u003cli data-pid=\"cDAj3af4\"\u003emmc_sd_init_card() \u0026gt;\u0026gt; mmc_sd_setup_card() \u0026gt;\u0026gt; mmc_read_switch()\u003c/li\u003e\u003cli data-pid=\"sfolPGrF\"\u003emmc_sd_init_card() \u0026gt;\u0026gt; mmc_read_switch()\u003c/li\u003e\u003c/ol\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_sd_init_card\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eu32\u003c/span\u003e \u003cspan class=\"n\"\u003eocr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_card\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eoldcard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_sd_get_cid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eocr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003erocr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 设定电压\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_sd_setup_card\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoldcard\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 第一条线\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003efree_card\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * If the card has not been power cycled, it may still be using 1.8V\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * signaling. Detect that situation and try to initialize a UHS-I (1.8V)\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * transfer mode.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ev18_fixup_failed\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_host_is_spi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host_uhs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\t    \u003cspan class=\"n\"\u003emmc_sd_card_using_v18\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\t    \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eios\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignal_voltage\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_SIGNAL_VOLTAGE_180\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t\t * Re-read switch information in case it has changed since\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t\t * oldcard was initialized.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t\t */\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoldcard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_read_switch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e// 第二条线\n\u003c/span\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003efree_card\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_sd_card_using_v18\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_host_set_uhs_voltage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n\t\t\t    \u003cspan class=\"n\"\u003emmc_sd_init_uhs_card\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003ev18_fixup_failed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003emmc_power_cycle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eocr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eoldcard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\t\t\t\u003cspan class=\"n\"\u003emmc_remove_card\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003eretry\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003econt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"i695eK08\"\u003e第一条线只发生一次，是在第一次初始化SD卡，也就是被mmc_attach_sd()调用的时候。这时card还没有被初始化，oldcard为NULL。\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_sd_setup_card\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_card\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ereinit\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ereinit\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\t\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t\t * Fetch switch information from card.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t\t */\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_read_switch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"lpa11zFE\"\u003emmc_sd_setup_card()收到的reinit参数为false，进入if语句执行mmc_read_switch()，没有问题。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"2IHTSzta\"\u003e第二条线会在每次resume判断是否执行。判断条件的重点在\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"n\"\u003emmc_sd_card_using_v18\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eios\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignal_voltage\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_SIGNAL_VOLTAGE_180\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_sd_card_using_v18\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_card\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * According to the SD spec., the Bus Speed Mode (function group 1) bits\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * 2 to 4 are zero if the card is initialized at 3.3V signal level. Thus\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * they can be used to determine if the card has already switched to\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * 1.8V signaling.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esw_caps\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esd3_bus_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\n\t       \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSD_MODE_UHS_SDR50\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eSD_MODE_UHS_SDR104\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eSD_MODE_UHS_DDR50\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"yFFxpLpf\"\u003e也就是说如果SD卡当前信号电压为1.8V并且读卡器的信号电压不为1.8V才进入if条件执行mmc_read_switch()。我们先模拟从UHS模式正常运行到resume时设定电压失败的情况：\u003c/p\u003e\u003col\u003e\u003cli data-pid=\"R5_zroxB\"\u003eresume调用mmc_sd_init_card()\u003c/li\u003e\u003c/ol\u003e\u003cp data-pid=\"Gn9lDcXI\"\u003e2. mmc_sd_init_card()调用mmc_sd_get_cid()设定电压失败\u003c/p\u003e\u003cp data-pid=\"sFYOo-EN\"\u003e3. mmc_sd_init_card()进入第二条线的if判断。mmc_sd_card_using_v18()返回true，因为suspend之前SD卡在1.8V。(host-\u0026gt;ios.signal_voltage != MMC_SIGNAL_VOLTAGE_180)为true，因为设定电压失败，读卡器的信号在默认的3.3V上。if条件成立。\u003c/p\u003e\u003cp data-pid=\"LNacehWv\"\u003e4. mmc_read_switch()执行，把card-\u0026gt;sw_caps.sd3_bus_mode更新为只支持high speed。\u003c/p\u003e\u003cp data-pid=\"iWd6SY9O\"\u003e然后再模拟后续resume设定电压成功的情况：\u003c/p\u003e\u003col\u003e\u003cli data-pid=\"eNidXCeh\"\u003eresume调用mmc_sd_init_card()\u003c/li\u003e\u003c/ol\u003e\u003cp data-pid=\"W8G6GrHL\"\u003e2. mmc_sd_init_card()调用mmc_sd_get_cid()设定电压成功\u003c/p\u003e\u003cp data-pid=\"FR2Cv3RY\"\u003e3. mmc_sd_init_card()进入第二条线的if判断。mmc_sd_card_using_v18()返回false，因为suspend之前SD卡在3.3V。(host-\u0026gt;ios.signal_voltage != MMC_SIGNAL_VOLTAGE_180)为false，因为设定电压成功，读卡器的信号在1.8V上。if条件不成立。\u003c/p\u003e\u003cp data-pid=\"h_wx0jUq\"\u003e4. mmc_read_switch()永远不会再被执行，card-\u0026gt;sw_caps.sd3_bus_mode卡死在high speed上。即使成功把电压设定到1.8V，系统仍然认为最大频率为50MHz，不能正常设定频率。\u003c/p\u003e\u003ch2\u003e解决方法\u003c/h2\u003e\u003cp data-pid=\"qPETZhS3\"\u003e把mmc_read_switch()移到if判断之前，无论之前的信号模式是什么，都更新card-\u0026gt;sw_caps.sd3_bus_mode。即使有少数电压设定失败，后续的resume也能重新使用UHS模式。\u003c/p\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode class=\"language-c\"\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emmc_sd_init_card\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eu32\u003c/span\u003e \u003cspan class=\"n\"\u003eocr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_card\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eoldcard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ev18_fixup_failed\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_host_is_spi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host_uhs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n\t\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t\t * Re-read switch information in case it has changed since\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t\t * oldcard was initialized.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t\t */\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoldcard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_read_switch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003efree_card\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * If the card has not been power cycled, it may still be using 1.8V\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * signaling. Detect that situation and try to initialize a UHS-I (1.8V)\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t * transfer mode.\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ev18_fixup_failed\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_host_is_spi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003emmc_host_uhs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\t    \u003cspan class=\"n\"\u003emmc_sd_card_using_v18\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n\t    \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eios\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignal_voltage\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eMMC_SIGNAL_VOLTAGE_180\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_sd_card_using_v18\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emmc_host_set_uhs_voltage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n\t\t\t    \u003cspan class=\"n\"\u003emmc_sd_init_uhs_card\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003ev18_fixup_failed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003emmc_power_cycle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eocr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eoldcard\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\t\t\t\u003cspan class=\"n\"\u003emmc_remove_card\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecard\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003eretry\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003econt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp data-pid=\"bkB7zGHo\"\u003e编译，刷机。SD卡速度快了4倍甚至3倍！\u003c/p\u003e\u003cp data-pid=\"55hGW9Xi\"\u003e（CPDT在安卓13测不了外部存储，换了个软件）\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic2.zhimg.com/v2-7c7d92485c74800c425e6306b5f8d4c9_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"1075\" data-rawheight=\"2276\" data-original-token=\"v2-ab4e25dc88d34aa151c58a5cef259d93\" class=\"origin_image zh-lightbox-thumb\" width=\"1075\" data-original=\"https://pic2.zhimg.com/v2-7c7d92485c74800c425e6306b5f8d4c9_r.jpg\"/\u003e\u003cfigcaption\u003e读取\u003c/figcaption\u003e\u003c/figure\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pica.zhimg.com/v2-3314c54fbc4f22b4e4b17e2ca2eb65d8_1440w.jpg\" data-size=\"normal\" data-rawwidth=\"1078\" data-rawheight=\"2270\" data-original-token=\"v2-06182300ed15c76b677f1d9b010ed89d\" class=\"origin_image zh-lightbox-thumb\" width=\"1078\" data-original=\"https://pica.zhimg.com/v2-3314c54fbc4f22b4e4b17e2ca2eb65d8_r.jpg\"/\u003e\u003cfigcaption\u003e写入\u003c/figcaption\u003e\u003c/figure\u003e\u003cp data-pid=\"kLEiBcgS\"\u003e2024/08/30更新\u003c/p\u003e\u003cp data-pid=\"U1hdPLWH\"\u003e安卓主线内核5.10版本已经修复了这个问题（坏了这下重复发明轮子了，但折腾还是好玩的）\u003c/p\u003e\u003cp data-pid=\"SCNvMbl-\"\u003e\u003ca href=\"https://link.zhihu.com/?target=https%3A//github.com/aosp-mirror/kernel_common/commit/b3f2adf4262135a8b71f329da82b5c60a51309c6\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003emmc: core: Fix inconsistent sd3_bus_mode at UHS-I SD voltage switch f… · aosp-mirror/kernel_common@b3f2adf (github.com)\u003c/a\u003e\u003c/p\u003e\u003cp data-pid=\"6nULAJm7\"\u003e我的手机内核是5.4版本，还没有应用这个修复。其他手机如果没有及时跟进内核版本，可能也会遇到这个问题。\u003c/p\u003e",
      "is_labeled": false,
      "visited_count": 8036,
      "thumbnails": ["https://picx.zhimg.com/v2-72c0a1941dc03e3b44088e877f162e8a.jpg?source=7e7ef6e2\u0026needBackground=1", "https://picx.zhimg.com/50/v2-7880eb374901c97b2e04229b18753453_720w.jpg?source=b6762063", "https://picx.zhimg.com/50/v2-c69d71ce67ff468406989dc319685ef0_720w.jpg?source=b6762063", "https://pica.zhimg.com/50/v2-3bf6d60ce481194ddecd0d804d5395d4_720w.jpg?source=b6762063", "https://pica.zhimg.com/50/v2-1d8fab96569c195c1565339540a09bd4_720w.jpg?source=b6762063"],
      "favorite_count": 259,
      "article_type": "normal"
    },
    "brief": "{\"source\": \"TS\", \"type\": \"article\", \"id\": 716915076}",
    "attached_info": "CugICIiI3+OMxaelrgEQBxoJMjQ3NDQ0NDc3II23u7YGKLcCMBRACEooCh1UU19TT1VSQ0VfTkVBUkxJTkVfQ09OVEVOVF9WMhIBMBgAIAA6AGIgNDA2MmZjZTQxOTVmZmRjZDFmZjYyMDdlMGEwNzA4YmFyCTcxNjkxNTA3NoIBX2h0dHBzOi8vcGljeC56aGltZy5jb20vdjItNzJjMGExOTQxZGMwM2UzYjQ0MDg4ZTg3N2YxNjJlOGEuanBnP3NvdXJjZT03ZTdlZjZlMiZuZWVkQmFja2dyb3VuZD0xqgEJcmVjb21tZW5kwgEgMzgyMDc1ZmE5NWQ3YTU0ZTU4Y2UzZjJhODU0NmU1ZTHyAQoIDBIGTm9ybWFs8gEoCAoSJDAxNTk4ZTY0LTZiOWQtNGY1ZS1hNmY3LTQ4ZTI4ZTNhYjBiMfIBBQgLEgEyggIAiAL0/Yyk1jKSAiAzODIwNzVmYTk1ZDdhNTRlNThjZTNmMmE4NTQ2ZTVlMZoCAMoCFEZpcnN0QnJ1c2hXZWlnaHRSdWxlygIVTGVzc1NpbWlsYXJXZWlnaHRSdWxlygIWU2hvckludGVyZXN0V2VpZ2h0UnVsZcoCG0ludGVyYWN0aW9uU2hvckludGVyZXN0UnVsZcoCFVVzZXJMY25FeGl0V2VpZ2h0UnVsZcoCFENvbnRlbnRBZ2VXZWlnaHRSdWxlygIVVXNlclVuSW50ZXJlc3RBZ2dSdWxl2gIdVFNfU09VUkNFX05FQVJMSU5FX0NPTlRFTlRfVjLoAgP6AgtOT1JNQUxfRkxPV4oDIDlmYjU0ZWFmOGVlMDQ5ZWJiODc1ZTVlMTk3ZDJiMTY1mgMNCgJ2MhAAGgVvdGhlcqgD5D7YAwD6A7gCEgxVTktOT1dOX01PREUgACoNTk9fSU1BR0VfTU9ERTotCAIQuAgY4BIiI3YyLTcyYzBhMTk0MWRjMDNlM2I0NDA4OGU4NzdmMTYyZThhOi0IAhCkDRiwCSIjdjItZTRlYjk0MWFiMTE0YWFkOTVlZGMwOWM2YmY2MGNkOGI6LQgCENUHGMsEIiN2Mi1lNTQyZjQ5ODg3MGNhZmQ5MzQyNjg2ZThmZDEyNTkwNzosCAIQnQUYTSIjdjItNmI5MTk4N2RiYzVhMTkzZmNmOGFkNTRhOWVhZjM1MWQ6LQgCELMIGOQRIiN2Mi1hYjRlMjVkYzg4ZDM0YWExNTFjNThhNWNlZjI1OWQ5MzotCAIQtggY3hEiI3YyLTA2MTgyMzAwZWQxNWM3NmI2NzdmMWQ5YjAxMGVkODlkgAQAiAQAkgQGTm9ybWFsmgQBM6AEAKgEALAEALoEBm1hbnVhbMIEAzE3MMgEANIED+aOqOiNkOW3suabtOaWsNgEAPAEAPkEAAAAYFzIqz+BBQAAAAAAAAAAiQWhHRGx9nG0P5IFAJoFA2RmdKIFA2RmdLIFATG5BQAAAAAAAAAA0AUA4AUA6AUA8AUCkAYAoAYIqAYDkgIkCgkyNDc0NDQ0NzcSCTcxNjkxNTA3NhgHIgpJTUFHRV9URVhU",
    "action_card": false
  }, {
    "id": "9_1741148077.832",
    "type": "feed",
    "offset": 9,
    "verb": "TOPIC_ACKNOWLEDGED_ANSWER",
    "created_time": 1741148077,
    "updated_time": 1741148077,
    "target": {
      "id": "65923028775",
      "type": "answer",
      "url": "https://api.zhihu.com/answers/65923028775",
      "author": {
        "id": "48c7cf59bfe4dc318bb66c3b05842cbc",
        "url": "https://api.zhihu.com/people/48c7cf59bfe4dc318bb66c3b05842cbc",
        "user_type": "people",
        "url_token": "yi-ran-14-90",
        "name": "依然",
        "headline": "目标是混吃等死到退休的中控员一枚",
        "avatar_url": "https://picx.zhimg.com/50/v2-66a174327c2cf85bf2da0708f539a4a1_l.jpg?source=b6762063",
        "is_org": false,
        "gender": 1,
        "followers_count": 16914,
        "is_following": false,
        "is_followed": false
      },
      "created_time": 1735355889,
      "updated_time": 1735356229,
      "voteup_count": 4009,
      "thanks_count": 42,
      "comment_count": 202,
      "is_copyable": true,
      "question": {
        "id": "528520623",
        "type": "question",
        "url": "https://api.zhihu.com/questions/528520623",
        "author": {
          "id": "a21ad8c80e21b63fbb0b6511745a6ae0",
          "url": "https://api.zhihu.com/people/a21ad8c80e21b63fbb0b6511745a6ae0",
          "user_type": "people",
          "url_token": "wu-suo-wei-guan-dian",
          "name": "也不知道叫什么",
          "headline": "内向型话痨，所以选择了知乎来分享自己。",
          "avatar_url": "https://pic1.zhimg.com/50/v2-9f9ed97f6752f080ad24a786652806c3_l.jpg?source=b6762063",
          "is_org": false,
          "gender": 1,
          "followers_count": 212,
          "is_following": false,
          "is_followed": false
        },
        "title": "和女生合租，都会发生什么事情？",
        "created": 1650202134,
        "answer_count": 0,
        "follower_count": 0,
        "comment_count": 13,
        "bound_topic_ids": [20792, 41796, 166548],
        "is_following": false,
        "excerpt": "",
        "relationship": {
          "is_author": false
        },
        "detail": "",
        "question_type": "normal"
      },
      "excerpt": "正常人都知道， 合租最合适的是，单身，男性，it工作。 那种996的最好。",
      "excerpt_new": "正常人都知道， 合租最合适的是，单身，男性，it工作。 那种996的最好。",
      "preview_type": "default",
      "preview_text": "",
      "reshipment_settings": "allowed",
      "content": "\u003cp data-pid=\"RqTnObnf\"\u003e正常人都知道，\u003c/p\u003e\u003cp data-pid=\"YzRmtgwh\"\u003e合租最合适的是，单身，男性，it工作。\u003c/p\u003e\u003cp data-pid=\"Ni9WZRqV\"\u003e那种996的最好。\u003c/p\u003e",
      "relationship": {
        "is_thanked": false,
        "is_nothelp": false,
        "voting": 0
      },
      "is_labeled": false,
      "visited_count": 368570,
      "favorite_count": 187,
      "answer_type": "normal"
    },
    "brief": "{\"source\": \"TS\", \"type\": \"answer\", \"id\": 65923028775}",
    "attached_info": "CqIGCIiI3+OMxaelrgEQBBoJNzA2Mjk5NjUwIPHbvbsGKKkfMMoBQAlKMQomVFNfU09VUkNFX1RFWFRfTVVMVElWSUVXX0dDRl9VU0VSQ0ZfVjESATAYACAAOgBaCDc5NzMwOTg0YiA0MDYyZmNlNDE5NWZmZGNkMWZmNjIwN2UwYTA3MDhiYXILNjU5MjMwMjg3NzWKAQk1Mjg1MjA2MjOqAQlyZWNvbW1lbmTCASA0OGM3Y2Y1OWJmZTRkYzMxOGJiNjZjM2IwNTg0MmNiY/IBCggMEgZOb3JtYWzyASgIChIkMTkwYzc2NTQtZmYzZi00NDE2LTk5MTctMTdjZDJjYjAyZTA18gEFCAsSATKCAgCIAvT9jKTWMpICIDQ4YzdjZjU5YmZlNGRjMzE4YmI2NmMzYjA1ODQyY2JjmgIAygIURmlyc3RCcnVzaFdlaWdodFJ1bGXKAhZSZXZpc2l0VmFsdWVXZWlnaHRSdWxlygISQ2xpcFBlYWtXZWlnaHRSdWxlygIVVXNlckxjbkV4aXRXZWlnaHRSdWxlygIUQ29udGVudEFnZVdlaWdodFJ1bGXKAiNRdWFsaXR5SW50ZXJhY3Rpb25Db250ZW50V2VpZ2h0UnVsZdoCJlRTX1NPVVJDRV9URVhUX01VTFRJVklFV19HQ0ZfVVNFUkNGX1Yx6AIC+gILTk9STUFMX0ZMT1eKAyA5ZmI1NGVhZjhlZTA0OWViYjg3NWU1ZTE5N2QyYjE2NZoDDQoCdjIQABoFb3RoZXKoA7q/FtgDAOoDGmZlZWQtdGV4dC1tdWx0aS11Y2YtcmVjYWxs+gMfEgxVTktOT1dOX01PREUgACoNTk9fSU1BR0VfTU9ERYAEAIgEAJIEBk5vcm1hbJoEATKgBACoBACwBAC6BAZtYW51YWzCBAMxNjDIBADSBA/mjqjojZDlt7Lmm7TmlrDYBADwBAD5BAAAAGDussI/gQUAAAAAAAAAAIkFoR0RsfZxtD+SBQCaBQNkZnSiBQNkZnSyBQExuQUAAAAAAAAAANAFAOAFAOgFAPAFApAGAKAGCagGAJICJgoJNzA2Mjk5NjUwEgs2NTkyMzAyODc3NRgEIgpJTUFHRV9URVhU",
    "action_card": false
  }, {
    "id": "10_1741148077.365",
    "type": "feed",
    "offset": 10,
    "verb": "TOPIC_ACKNOWLEDGED_ANSWER",
    "created_time": 1741148077,
    "updated_time": 1741148077,
    "target": {
      "id": "3386962057",
      "type": "answer",
      "url": "https://api.zhihu.com/answers/3386962057",
      "author": {
        "id": "4dff4cfd65722f00b0922ec14fab1bc3",
        "url": "https://api.zhihu.com/people/4dff4cfd65722f00b0922ec14fab1bc3",
        "user_type": "people",
        "url_token": "98-85-58-95-67",
        "name": "弗拉德",
        "headline": "",
        "avatar_url": "https://pica.zhimg.com/50/v2-31ee151633cab489fcec9f431eb6a563_l.jpg?source=b6762063",
        "is_org": false,
        "gender": 1,
        "followers_count": 326,
        "is_following": false,
        "is_followed": false
      },
      "created_time": 1707032896,
      "updated_time": 1707032896,
      "voteup_count": 32335,
      "thanks_count": 606,
      "comment_count": 1361,
      "is_copyable": true,
      "question": {
        "id": "576373671",
        "type": "question",
        "url": "https://api.zhihu.com/questions/576373671",
        "author": {
          "id": "28cf3839b1f3c7b52c4abac336658cc2",
          "url": "https://api.zhihu.com/people/28cf3839b1f3c7b52c4abac336658cc2",
          "user_type": "people",
          "url_token": "fu-chen-1-6",
          "name": "浮沉",
          "headline": "海岸工程建设者",
          "avatar_url": "https://pica.zhimg.com/50/v2-03d5dcaf249fcf1540eec955b5ab64d9_l.jpg?source=b6762063",
          "is_org": false,
          "gender": -1,
          "followers_count": 52,
          "is_following": false,
          "is_followed": false
        },
        "title": "被戴了帽子，拼着被拘留，也要打奸夫一顿，值得吗？",
        "created": 1672685432,
        "answer_count": 0,
        "follower_count": 0,
        "comment_count": 51,
        "bound_topic_ids": [215, 8313, 35386, 347330, 216274],
        "is_following": false,
        "excerpt": "",
        "relationship": {
          "is_author": false
        },
        "detail": "",
        "question_type": "normal"
      },
      "thumbnail": "https://pica.zhimg.com/50/v2-596f2bfd83333d191dd16db39c442ec1_720w.jpg?source=b6762063",
      "excerpt": "与这位仁兄比起来，我的意见相当不值一提",
      "excerpt_new": "与这位仁兄比起来，我的意见相当不值一提",
      "preview_type": "default",
      "preview_text": "",
      "reshipment_settings": "allowed",
      "content": "\u003cp data-pid=\"eY1SrqLX\"\u003e与这位仁兄比起来，我的意见相当不值一提\u003c/p\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://picx.zhimg.com/v2-4cb1f1ab61c98608f3ea120fb1e9dde1_1440w.jpg\" data-rawwidth=\"1080\" data-rawheight=\"2400\" data-size=\"normal\" data-original-token=\"v2-120ecc1ea58c3d0d4295eca62ab50bb6\" data-default-watermark-src=\"https://pic2.zhimg.com/v2-cb429fefe76112e96fcc7270738be1f5_b.jpg\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://picx.zhimg.com/v2-4cb1f1ab61c98608f3ea120fb1e9dde1_r.jpg\"/\u003e\u003c/figure\u003e\u003cp\u003e\u003c/p\u003e",
      "relationship": {
        "is_thanked": false,
        "is_nothelp": false,
        "voting": 0
      },
      "is_labeled": false,
      "visited_count": 2052822,
      "thumbnails": ["https://picx.zhimg.com/50/v2-596f2bfd83333d191dd16db39c442ec1_720w.jpg?source=b6762063"],
      "favorite_count": 4557,
      "answer_type": "normal"
    },
    "brief": "{\"source\": \"TS\", \"type\": \"answer\", \"id\": 3386962057}",
    "attached_info": "Cr4HCIiI3+OMxaelrgEQBBoJNjQ1ODg3NjUyIMCC/a0GKM/8ATDRCkAKSjEKJlRTX1NPVVJDRV9URVhUX01VTFRJVklFV19HQ0ZfVVNFUkNGX1YxEgEwGAAgADoAWgg5MDM2NDQ5N2IgNDA2MmZjZTQxOTVmZmRjZDFmZjYyMDdlMGEwNzA4YmFyCjMzODY5NjIwNTeKAQk1NzYzNzM2NzGqAQlyZWNvbW1lbmTCASA0ZGZmNGNmZDY1NzIyZjAwYjA5MjJlYzE0ZmFiMWJjM/IBCggMEgZOb3JtYWzyASgIChIkMzVjNzNhOWEtMTk5Zi00NTBjLTkxN2MtMmVjMjM4MGM5NzI28gEFCAsSATKCAgCIAvT9jKTWMpICIDRkZmY0Y2ZkNjU3MjJmMDBiMDkyMmVjMTRmYWIxYmMzmgIAygIURmlyc3RCcnVzaFdlaWdodFJ1bGXKAhZBY3Rpb25TaG9ySW50ZXJlc3RSdWxlygIbSW50ZXJhY3Rpb25TaG9ySW50ZXJlc3RSdWxlygIWUmV2aXNpdFZhbHVlV2VpZ2h0UnVsZcoCGFBlcmlvZEludGVyZXN0V2VpZ2h0UnVsZcoCFU5lZ0ZlZWRCYWNrV2VpZ2h0UnVsZcoCFVVzZXJMY25FeGl0V2VpZ2h0UnVsZcoCFENvbnRlbnRBZ2VXZWlnaHRSdWxlygIjUXVhbGl0eUludGVyYWN0aW9uQ29udGVudFdlaWdodFJ1bGXKAhVVc2VyVW5JbnRlcmVzdEFnZ1J1bGXaAiZUU19TT1VSQ0VfVEVYVF9NVUxUSVZJRVdfR0NGX1VTRVJDRl9WMegCAvoCC05PUk1BTF9GTE9XigMgOWZiNTRlYWY4ZWUwNDllYmI4NzVlNWUxOTdkMmIxNjWaAw0KAnYyEAAaBW90aGVyqAPWpX3YAwDqAxpmZWVkLXRleHQtbXVsdGktdWNmLXJlY2FsbPoDThIMVU5LTk9XTl9NT0RFIAAqDU5PX0lNQUdFX01PREU6LQgCELgIGOASIiN2Mi0xMjBlY2MxZWE1OGMzZDBkNDI5NWVjYTYyYWI1MGJiNoAEAIgEAJIEBk5vcm1hbJoEATKgBACoBACwBAC6BAZtYW51YWzCBAMxNjDIBADSBA/mjqjojZDlt7Lmm7TmlrDYBADwBAD5BAAAAIDT2cM/gQUAAAAAAAAAAIkFoR0RsfZxtD+SBQCaBQNkZnSiBQNkZnSyBQExuQUAAAAAAAAAANAFAOAFAOgFAPAFApAGAKAGCqgGAZICJQoJNjQ1ODg3NjUyEgozMzg2OTYyMDU3GAQiCklNQUdFX1RFWFQ=",
    "action_card": false
  }, {
    "id": "11_1741148077.609",
    "type": "feed",
    "offset": 11,
    "verb": "TOPIC_ACKNOWLEDGED_ARTICLE",
    "created_time": 1741148077,
    "updated_time": 1741148077,
    "target": {
      "id": "27829961641",
      "type": "article",
      "url": "https://api.zhihu.com/articles/27829961641",
      "author": {
        "id": "94ebe843f836fad9251f2329296c4ae5",
        "url": "https://api.zhihu.com/people/94ebe843f836fad9251f2329296c4ae5",
        "user_type": "organization",
        "url_token": "bo-wu-za-zhi-7",
        "name": "博物",
        "headline": "",
        "avatar_url": "https://picx.zhimg.com/50/v2-646c04d44128de78851cc726cd997e67_l.jpg?source=b6762063",
        "is_org": true,
        "gender": -1,
        "followers_count": 178316,
        "is_following": false,
        "is_followed": false
      },
      "title": "座头鲸吞了一只皮划艇？鲸：打扰了",
      "image_url": "https://pica.zhimg.com/v2-4deed5cc044051b80c8b76194ba7da48.jpg?source=7e7ef6e2\u0026needBackground=1",
      "comment_permission": "all",
      "created": 1741061533,
      "updated": 1741061533,
      "voteup_count": 23,
      "voting": 0,
      "comment_count": 4,
      "linkbox": {
        "category": "",
        "pic": "",
        "title": "",
        "url": ""
      },
      "excerpt": "最近有没有刷到这个视频——在智利麦哲伦海峡，一头座头鲸吞食了一名皮划艇运动员，然后又迅速把他吐了出来。   座头鲸：你好，再见。 当事人Simancas说“我以为我死了……” 座头鲸（ Megaptera novaeangliae）以小鱼和甲壳动物为食。为了吃足够的食物来维持它们巨大的体型，鲸鱼会一大口吞下超过23000升的海水，并通过鲸须盘过滤猎物——有点像长而多毛的牙齿，过滤而不是咬。但这种策略只是为了捕食小动物，而不是皮划艇上的人…",
      "excerpt_new": "最近有没有刷到这个视频——在智利麦哲伦海峡，一头座头鲸吞食了一名皮划艇运动员，然后又迅速把他吐了出来。   座头鲸：你好，再见。 当事人Simancas说“我以为我死了……” 座头鲸（ Megaptera novaeangliae）以小鱼和甲壳动物为食。为了吃足够的食物来维持它们巨大的体型，鲸鱼会一大口吞下超过23000升的海水，并通过鲸须盘过滤猎物——有点像长而多毛的牙齿，过滤而不是咬。但这种策略只是为了捕食小动物，而不是皮划艇上的人…",
      "preview_type": "default",
      "preview_text": "",
      "content": "\u003cp data-pid=\"yfOkucSt\"\u003e最近有没有刷到这个视频——在智利麦哲伦海峡，一头座头鲸吞食了一名皮划艇运动员，然后又迅速把他吐了出来。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic2.zhimg.com/v2-b29113a63590dcbbb61165588f872451_1440w.gif\" data-rawwidth=\"697\" data-caption=\"\" data-size=\"normal\" data-rawheight=\"392\" data-thumbnail=\"https://pic2.zhimg.com/v2-b29113a63590dcbbb61165588f872451_b.jpg\" data-original-token=\"v2-b29113a63590dcbbb61165588f872451\" class=\"origin_image zh-lightbox-thumb\" width=\"697\" data-original=\"https://pic2.zhimg.com/v2-b29113a63590dcbbb61165588f872451_r.jpg\"/\u003e\u003c/figure\u003e\u003c/p\u003e\u003cp data-pid=\"iVWFkTEo\"\u003e座头鲸：你好，再见。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"l5-R4hKV\"\u003e当事人Simancas说“我以为我死了……”\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"KRvhvJiu\"\u003e座头鲸（\u003cem\u003eMegaptera novaeangliae\u003c/em\u003e）以小鱼和甲壳动物为食。为了吃足够的食物来维持它们巨大的体型，鲸鱼会一大口吞下超过23000升的海水，并通过鲸须盘过滤猎物——有点像长而多毛的牙齿，过滤而不是咬。但这种策略只是为了捕食小动物，而不是皮划艇上的人类。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://picx.zhimg.com/v2-9f8e1d313ab29885a3fb1ad15238341d_1440w.jpg\" data-rawwidth=\"1080\" data-caption=\"\" data-size=\"normal\" data-rawheight=\"720\" data-original-token=\"v2-9f8e1d313ab29885a3fb1ad15238341d\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://picx.zhimg.com/v2-9f8e1d313ab29885a3fb1ad15238341d_r.jpg\"/\u003e\u003c/figure\u003e\u003c/p\u003e\u003cp\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pica.zhimg.com/v2-f00c734ec542e5ac29d9723e357503c2_1440w.jpg\" data-rawwidth=\"1000\" data-caption=\"\" data-size=\"normal\" data-rawheight=\"952\" data-original-token=\"v2-f00c734ec542e5ac29d9723e357503c2\" class=\"origin_image zh-lightbox-thumb\" width=\"1000\" data-original=\"https://pica.zhimg.com/v2-f00c734ec542e5ac29d9723e357503c2_r.jpg\"/\u003e\u003c/figure\u003e\u003c/p\u003e\u003cp data-pid=\"mfAVdW4w\"\u003e座头鲸的鲸须\u003c/p\u003e\u003cp data-pid=\"pAGMUJcb\"\u003e图源：\u003ca href=\"https://link.zhihu.com/?target=http%3A//sophiezyla.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003e\u003cspan class=\"invisible\"\u003ehttp://\u003c/span\u003e\u003cspan class=\"visible\"\u003esophiezyla.com\u003c/span\u003e\u003cspan class=\"invisible\"\u003e\u003c/span\u003e\u003c/a\u003e\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"HkszIft-\"\u003e英国鲸鱼和海豚保护研究所的研究员霍伊特表示，视频中的鲸鱼肯定是意外地吞了皮划艇。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"56IP4GUC\"\u003e这已经不是鲸鱼第一次不小心把人吃掉了。2020年还有个加利福尼亚州的视频，一头座头鲸从水里出来，把两名皮划艇运动员吞了。据加拿大广播公司当时报道，当鲸出现时，皮划艇运动员正在一大群鱼的上方漂浮，座头鲸也立即释放了在事故中没有受伤的皮划艇运动员。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic2.zhimg.com/v2-5a93adbadac065befcf9053196000a81_1440w.jpg\" data-rawwidth=\"1080\" data-caption=\"\" data-size=\"normal\" data-rawheight=\"608\" data-original-token=\"v2-5a93adbadac065befcf9053196000a81\" class=\"origin_image zh-lightbox-thumb\" width=\"1080\" data-original=\"https://pic2.zhimg.com/v2-5a93adbadac065befcf9053196000a81_r.jpg\"/\u003e\u003c/figure\u003e\u003c/p\u003e\u003cp data-pid=\"M0MxGi2c\"\u003e在智利，一头座头鲸（不是吞皮划艇事件的那头）浮出水面觅食。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"z7-5cOee\"\u003e还有2021年，美国马萨诸塞州的一名潜水抓龙虾的工作人员说，他大概在座头鲸的嘴里呆了30秒，然后被吐了出来。鲸鱼研究人员认为，这名潜水员可能也游得离鲸鱼的食物太近了，不小心被鲸鱼吞食物时一起吞了。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"o_bzgkag\"\u003e霍伊特说，人太大了，座头鲸不可能真吞得下，以前他们在座头鲸的胃里发现过卡辛小海雀（\u003cem\u003ePtychoramphus aleuticus\u003c/em\u003e），估计也是被意外吞下的，但这些鸟也就23厘米长。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic3.zhimg.com/v2-41a57713ee60bb4dbbc4b4cdb0a742a6_1440w.jpg\" data-rawwidth=\"900\" data-caption=\"\" data-size=\"normal\" data-rawheight=\"600\" data-original-token=\"v2-41a57713ee60bb4dbbc4b4cdb0a742a6\" class=\"origin_image zh-lightbox-thumb\" width=\"900\" data-original=\"https://pic3.zhimg.com/v2-41a57713ee60bb4dbbc4b4cdb0a742a6_r.jpg\"/\u003e\u003c/figure\u003e\u003c/p\u003e\u003cp data-pid=\"U9NL7fpU\"\u003e我也冤枉啊\u003c/p\u003e\u003cp data-pid=\"QoygLyEX\"\u003e图源：The Daily World\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"VrG8ncJi\"\u003e虽然座头鲸不吃人，但当它们感到受到威胁时，偶尔会伤害人类。2020年，澳大利亚一头座头鲸妈妈可能是为了保护她的孩子袭击了游泳者，使两人入院。然而，这个物种更出名的是偶尔拯救其他动物免受虎鲸等掠食者的伤害，而不是伤害人类。不过霍伊特也说，浮在海上的人类也几乎不用害怕虎鲸，也没有野生虎鲸捕杀和吃掉人类的案例。\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"P7kavcDc\"\u003e但也有记载1972年在加利福尼亚的一个冲浪者被野生虎鲸咬伤，虎鲸可能误认为他是海豹了……\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp\u003e\u003cfigure data-size=\"normal\"\u003e\u003cimg src=\"https://pic3.zhimg.com/v2-af7e0c3b77cc4de775ed873e4cbfae02_1440w.jpg\" data-rawwidth=\"474\" data-caption=\"\" data-size=\"normal\" data-rawheight=\"316\" data-original-token=\"v2-af7e0c3b77cc4de775ed873e4cbfae02\" class=\"origin_image zh-lightbox-thumb\" width=\"474\" data-original=\"https://pic3.zhimg.com/v2-af7e0c3b77cc4de775ed873e4cbfae02_r.jpg\"/\u003e\u003c/figure\u003e\u003c/p\u003e\u003cp data-pid=\"gknxvZI6\"\u003e虎鲸：报一丝\u003c/p\u003e\u003cp data-pid=\"wPgexPya\"\u003e图源：ThoughtCo|\u003c/p\u003e\u003cp class=\"ztext-empty-paragraph\"\u003e\u003cbr/\u003e\u003c/p\u003e\u003cp data-pid=\"3CpJki9F\"\u003e来源 | livescience\u003c/p\u003e\u003cp data-pid=\"LXdfNiTU\"\u003e翻译 | 赵之遇\u003c/p\u003e\u003cp data-pid=\"MvSlAiAE\"\u003e部分图片 | 图虫创意\u003c/p\u003e\u003cp data-pid=\"ZCD_uprW\"\u003e微信编辑 | 赵之遇\u003c/p\u003e",
      "is_labeled": false,
      "visited_count": 932,
      "thumbnails": ["https://pica.zhimg.com/v2-4deed5cc044051b80c8b76194ba7da48.jpg?source=7e7ef6e2\u0026needBackground=1", "https://picx.zhimg.com/50/v2-b45ebdcd0730337d27acb0ac3fe98de3_720w.jpg?source=b6762063", "https://picx.zhimg.com/50/v2-04b6add66cd0b4c880d34b3c6039e65b_720w.jpg?source=b6762063"],
      "favorite_count": 1,
      "article_type": "normal"
    },
    "brief": "{\"source\": \"TS\", \"type\": \"article\", \"id\": 27829961641}",
    "attached_info": "CtAJCIiI3+OMxaelrgEQBxoJMjU0NTg4NTcxIJ37mb4GKBcwBEALSkEKLFRTX1NPVVJDRV9UV09UT1dFUl9TSE9SVElOVEVSRVNUX1JFQ0FMTF9URVhUEgEwGAAgADoKeyJyYXciOiIifWIgNDA2MmZjZTQxOTVmZmRjZDFmZjYyMDdlMGEwNzA4YmFyCzI3ODI5OTYxNjQxggFfaHR0cHM6Ly9waWNhLnpoaW1nLmNvbS92Mi00ZGVlZDVjYzA0NDA1MWI4MGM4Yjc2MTk0YmE3ZGE0OC5qcGc/c291cmNlPTdlN2VmNmUyJm5lZWRCYWNrZ3JvdW5kPTGqAQlyZWNvbW1lbmTCASA5NGViZTg0M2Y4MzZmYWQ5MjUxZjIzMjkyOTZjNGFlNfIBCggMEgZOb3JtYWzyASgIChIkMDg4ODY1OWEtZDM2NS00ODQwLWI4MzYtMjNhMTkwMjAyY2Iz8gEFCAsSATKCAgCIAvT9jKTWMpICIDk0ZWJlODQzZjgzNmZhZDkyNTFmMjMyOTI5NmM0YWU1mgIAygIURmlyc3RCcnVzaFdlaWdodFJ1bGXKAhZTaG9ySW50ZXJlc3RXZWlnaHRSdWxlygIbSW50ZXJhY3Rpb25TaG9ySW50ZXJlc3RSdWxlygIYUGVyaW9kSW50ZXJlc3RXZWlnaHRSdWxlygIVVXNlckxjbkV4aXRXZWlnaHRSdWxlygIVVXNlclVuSW50ZXJlc3RBZ2dSdWxl2gIsVFNfU09VUkNFX1RXT1RPV0VSX1NIT1JUSU5URVJFU1RfUkVDQUxMX1RFWFToAgX6AgtOT1JNQUxfRkxPV4oDIDlmYjU0ZWFmOGVlMDQ5ZWJiODc1ZTVlMTk3ZDJiMTY1mgMNCgJ2MhAAGgVvdGhlcqgDpAfYAwDqAyBmZWVkX2ludGVyZXN0X2F0dG1fdHdvdG93ZXJfdGV4dPoD6AISDFVOS05PV05fTU9ERSAAKg1OT19JTUFHRV9NT0RFOi0IABC5BRiIAyIjdjItYjI5MTEzYTYzNTkwZGNiYmI2MTE2NTU4OGY4NzI0NTE6LQgDELgIGNAFIiN2Mi05ZjhlMWQzMTNhYjI5ODg1YTNmYjFhZDE1MjM4MzQxZDotCAQQ6AcYuAciI3YyLWYwMGM3MzRlYzU0MmU1YWMyOWQ5NzIzZTM1NzUwM2MyOi0IAxC4CBjgBCIjdjItNWE5M2FkYmFkYWMwNjViZWZjZjkwNTMxOTYwMDBhODE6LQgDEIQHGNgEIiN2Mi00MWE1NzcxM2VlNjBiYjRkYmJjNGI0Y2RiMGE3NDJhNjotCAMQ2gMYvAIiI3YyLWFmN2UwYzNiNzdjYzRkZTc3NWVkODczZTRjYmZhZTAyOi0IAxC4CBjMAyIjdjItNGRlZWQ1Y2MwNDQwNTFiODBjOGI3NjE5NGJhN2RhNDiABACIBACSBAZOb3JtYWyaBAE1oAQAqAQAsAQAugQGbWFudWFswgQDMTcwyAQA0gQP5o6o6I2Q5bey5pu05paw2AQA8AQA+QQAAABg2Rq3P4EFAAAAAAAAAACJBaEdEbH2cbQ/kgUAmgUDZGZ0ogUDZGZ0sgUBMbkFAAAAAAAAAADQBQDgBQDoBQDwBQKQBgCgBguoBgCSAiYKCTI1NDU4ODU3MRILMjc4Mjk5NjE2NDEYByIKSU1BR0VfVEVYVA==",
    "action_card": false
  }],
  "paging": {
    "is_end": false,
    "is_start": false,
    "next": "https://www.zhihu.com/api/v3/feed/topstory/recommend?action=down\u0026ad_interval=-10\u0026after_id=11\u0026desktop=true\u0026end_offset=11\u0026page_number=3\u0026session_token=4062fce4195ffdcd1ff6207e0a0708ba",
    "previous": "https://www.zhihu.com/api/v3/feed/topstory/recommend?action=pull\u0026ad_interval=-10\u0026before_id=11\u0026desktop=true\u0026end_offset=11\u0026page_number=3\u0026session_token=4062fce4195ffdcd1ff6207e0a0708ba",
    "totals": 0
  },
  "fresh_text": "推荐已更新"
}